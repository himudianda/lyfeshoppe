{% extends 'layouts/app.jinja2' %}
{% import 'macros/items.jinja2' as items %}
{% import 'macros/form.jinja2' as f with context %}
{% import 'user/macros/business.jinja2' as account %}

{% block title %}Admin - Businesses / List{% endblock %}

{% block body %}
  {{ f.search('admin.businesses') }}

  {% if businesses.total == 0 %}
      <h3>No results found</h3>
    {% if request.args.get('q') %}
        <p>Try limiting or removing your search terms.</p>
    {% else %}
        <p>There are no businesses present, you should <a
                href="{{ url_for('user.business_signup') }}">sign up</a>.</p>
    {% endif %}
  {% else %}
        <table class="table table-striped">
            <thead>
            <tr>
                <th class="col-header">
                  {{ items.sort('name') }}
                </th>
                <th class="col-header">
                  {{ items.sort('last_sign_in_on', 'Last sign in date') }}
                </th>
                <th class="col-header">
                  {{ items.sort('sign_in_count', 'Sign in count') }}
                </th>
            </tr>
            </thead>
            <tbody>
            {% for business in businesses.items %}
                <tr>
                    <td>
                        <div class="pull-left">
                          {{ account.role_icon_for(business) }}
                        </div>
                        <h4 class="media-heading">{{ business.name }}</h4>

                        <p class="text-muted">{{ business.email }}</p>
                    </td>
                    <td>
                      {% if business.last_sign_in_on %}
                          <time class="from-now"
                                data-datetime="{{ business.last_sign_in_on }}">
                            {{ business.last_sign_in_on }}
                          </time>
                      {% endif %}
                    </td>
                    <td>{{ business.sign_in_count }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {{ items.paginate(businesses) }}
  {% endif %}
{% endblock %}
